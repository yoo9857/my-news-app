(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5980],{102:function(e,t,r){Promise.resolve().then(r.bind(r,9498))},9498:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var n=r(7437),o=r(2265),a=r(9376),s=r(6070),i=r(2869),l=r(5186),c=r(7107),u=r(257);function d(){let e=(0,a.useParams)().group_id,t=(0,a.useRouter)(),[r,d]=(0,o.useState)(null),[f,m]=(0,o.useState)([]),[p,h]=(0,o.useState)([]),[x,g]=(0,o.useState)(""),[v,y]=(0,o.useState)(!0),[b,N]=(0,o.useState)(null),[w,j]=(0,o.useState)(!1),[_,k]=(0,o.useState)(null),E=(0,o.useRef)(null),S=(0,o.useRef)(null),R=()=>{let e=localStorage.getItem("access_token"),t=localStorage.getItem("token_type");return e&&t?{Authorization:"".concat(t," ").concat(e),"Content-Type":"application/json"}:null},A=()=>{var e;null===(e=S.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,o.useEffect)(()=>{let t=async()=>{try{let t=await fetch("".concat(u.env.NEXT_PUBLIC_ADMIN_API_URL,"/api/groups/").concat(e));if(!t.ok)throw Error("그룹 정보를 불러오지 못했습니다.");let r=await t.json();d(r);let n=R();if(n){let t=await fetch("".concat(u.env.NEXT_PUBLIC_ADMIN_API_URL,"/api/groups/").concat(e,"/members/"),{headers:{Authorization:n.Authorization}});if(!t.ok)throw Error("그룹 멤버를 불러오지 못했습니다.");let r=await t.json();m(r);let o=await fetch("".concat(u.env.NEXT_PUBLIC_ADMIN_API_URL,"/api/chat/").concat(e,"/messages"),{headers:{Authorization:n.Authorization}});if(!o.ok)throw Error("채팅 메시지를 불러오지 못했습니다.");let a=await o.json();h(a.reverse())}}catch(e){N(e.message)}finally{y(!1)}};e&&t()},[e]),(0,o.useEffect)(()=>{if(!v&&r){var t;let r=localStorage.getItem("access_token"),n=localStorage.getItem("token_type");if(!r||!n){console.warn("WebSocket: No token found, real-time chat will not be available.");return}let o=null===(t=u.env.NEXT_PUBLIC_ADMIN_API_URL)||void 0===t?void 0:t.replace(/^http/,"ws");return E.current=new WebSocket("".concat(o,"/api/ws/chat/").concat(e,"?token=").concat(r)),E.current.onopen=()=>{console.log("WebSocket connected"),A()},E.current.onmessage=e=>{let t=JSON.parse(e.data);h(e=>[...e,t]),A()},E.current.onclose=e=>{console.log("WebSocket disconnected",e.code,e.reason)},E.current.onerror=e=>{console.error("WebSocket error",e),k("채팅 연결 오류 발생")},()=>{E.current&&E.current.readyState===WebSocket.OPEN&&E.current.close()}}},[v,r,e]),(0,o.useEffect)(()=>{A()},[p]);let P=async e=>{if(e.preventDefault(),x.trim()){if(j(!0),k(null),E.current&&E.current.readyState===WebSocket.OPEN)try{E.current.send(JSON.stringify({content:x})),g("")}catch(e){k("메시지 전송 실패")}finally{j(!1)}else k("채팅 서버에 연결되지 않았습니다."),j(!1)}},T=async()=>{let r=R();if(!r){alert("그룹을 삭제하려면 로그인이 필요합니다.");return}if(window.confirm("정말로 이 그룹을 삭제하시겠습니까? (그룹 소유자만 가능)"))try{let n=await fetch("".concat(u.env.NEXT_PUBLIC_ADMIN_API_URL,"/api/groups/").concat(e),{method:"DELETE",headers:{Authorization:r.Authorization}});if(!n.ok){let e=await n.json();throw Error(e.detail||"그룹 삭제 실패")}alert("그룹이 삭제되었습니다."),t.push("/groups")}catch(e){alert("삭제 실패: ".concat(e.message))}};return v?(0,n.jsx)("div",{className:"container mx-auto p-4 text-white",children:"그룹 정보 로딩 중..."}):b?(0,n.jsxs)("div",{className:"container mx-auto p-4 text-red-500",children:["오류: ",b]}):r?(0,n.jsxs)("div",{className:"container mx-auto p-4",children:[(0,n.jsxs)(s.Zb,{className:"bg-gray-800 text-white mb-6",children:[(0,n.jsxs)(s.Ol,{children:[(0,n.jsx)(s.ll,{className:"text-3xl font-bold",children:r.name}),(0,n.jsxs)("p",{className:"text-sm text-gray-400",children:["생성일: ",(0,c.WU)(new Date(r.created_at),"yyyy-MM-dd HH:mm")]})]}),(0,n.jsx)(s.aY,{children:(0,n.jsx)("p",{className:"text-lg whitespace-pre-wrap",children:r.description||"설명 없음"})}),(0,n.jsx)(s.eW,{className:"flex justify-end",children:(0,n.jsx)(i.z,{variant:"destructive",onClick:T,children:"그룹 삭제 (소유자만)"})})]}),(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4 text-white",children:"그룹 멤버"}),(0,n.jsx)("div",{className:"space-y-2 mb-6",children:0===f.length?(0,n.jsx)("p",{className:"text-gray-400",children:"아직 그룹 멤버가 없습니다."}):f.map(e=>(0,n.jsx)(s.Zb,{className:"bg-gray-700 text-white",children:(0,n.jsxs)(s.aY,{className:"pt-4",children:[(0,n.jsxs)("p",{children:["User ID: ",e.user_id," (Role: ",e.role,")"]}),(0,n.jsxs)("p",{className:"text-xs text-gray-400",children:["가입일: ",(0,c.WU)(new Date(e.joined_at),"yyyy-MM-dd HH:mm")]})]})},e.user_id))}),(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4 text-white",children:"채팅"}),(0,n.jsxs)(s.Zb,{className:"bg-gray-800 text-white mb-6",children:[(0,n.jsxs)(s.aY,{className:"h-80 overflow-y-auto p-4 space-y-2",children:[0===p.length?(0,n.jsx)("p",{className:"text-gray-400",children:"채팅 메시지가 없습니다."}):p.map(e=>(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("span",{className:"text-sm font-bold text-blue-400",children:["User ",e.sender_id]}),(0,n.jsx)("p",{className:"text-base",children:e.content}),(0,n.jsx)("span",{className:"text-xs text-gray-500 self-end",children:(0,c.WU)(new Date(e.created_at),"HH:mm")})]},e.id)),(0,n.jsx)("div",{ref:S})]}),(0,n.jsxs)(s.eW,{className:"p-4 border-t border-gray-700",children:[(0,n.jsxs)("form",{onSubmit:P,className:"flex w-full space-x-2",children:[(0,n.jsx)(l.I,{type:"text",placeholder:"메시지를 입력하세요...",value:x,onChange:e=>g(e.target.value),className:"flex-grow bg-gray-700 border-gray-600 text-white"}),(0,n.jsx)(i.z,{type:"submit",disabled:w||!x.trim(),children:w?"전송 중...":"전송"})]}),_&&(0,n.jsx)("p",{className:"text-red-500 text-sm mt-2",children:_})]})]})]}):(0,n.jsx)("div",{className:"container mx-auto p-4 text-white",children:"그룹을 찾을 수 없습니다."})}},2869:function(e,t,r){"use strict";r.d(t,{d:function(){return l},z:function(){return c}});var n=r(7437),o=r(2265),a=r(7053),s=r(535),i=r(4508);let l=(0,s.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=o.forwardRef((e,t)=>{let{className:r,variant:o,size:s,asChild:c=!1,...u}=e,d=c?a.g7:"button";return(0,n.jsx)(d,{className:(0,i.cn)(l({variant:o,size:s,className:r})),ref:t,...u})});c.displayName="Button"},6070:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return s},aY:function(){return u},eW:function(){return d},ll:function(){return l}});var n=r(7437),o=r(2265),a=r(4508);let s=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...o})});s.displayName="Card";let i=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",r),...o})});i.displayName="CardHeader";let l=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",r),...o})});l.displayName="CardTitle";let c=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",r),...o})});c.displayName="CardDescription";let u=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",r),...o})});u.displayName="CardContent";let d=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",r),...o})});d.displayName="CardFooter"},5186:function(e,t,r){"use strict";r.d(t,{I:function(){return s}});var n=r(7437),o=r(2265),a=r(4508);let s=o.forwardRef((e,t)=>{let{className:r,type:o,...s}=e;return(0,n.jsx)("input",{type:o,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...s})});s.displayName="Input"},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var n=r(1994),o=r(3335);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.m6)((0,n.W)(t))}},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},257:function(e,t,r){"use strict";var n,o;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(o=r.g.process)?void 0:o.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,n,o=e.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var l=[],c=!1,u=-1;function d(){c&&n&&(c=!1,n.length?l=n.concat(l):u=-1,l.length&&f())}function f(){if(!c){var e=i(d);c=!0;for(var t=l.length;t;){for(n=l,l=[];++u<t;)n&&n[u].run();u=-1,t=l.length}n=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function p(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new m(e,t)),1!==l.length||c||i(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=p,o.addListener=p,o.once=p,o.off=p,o.removeListener=p,o.removeAllListeners=p,o.emit=p,o.prependListener=p,o.prependOnceListener=p,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var a=r[e]={exports:{}},s=!0;try{t[e](a,a.exports,n),s=!1}finally{s&&delete r[e]}return a.exports}n.ab="//";var o=n(229);e.exports=o}()},8575:function(e,t,r){"use strict";r.d(t,{F:function(){return a},e:function(){return s}});var n=r(2265);function o(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function a(...e){return t=>{let r=!1,n=e.map(e=>{let n=o(e,t);return r||"function"!=typeof n||(r=!0),n});if(r)return()=>{for(let t=0;t<n.length;t++){let r=n[t];"function"==typeof r?r():o(e[t],null)}}}}function s(...e){return n.useCallback(a(...e),e)}},7053:function(e,t,r){"use strict";r.d(t,{A4:function(){return l},g7:function(){return s}});var n=r(2265),o=r(8575),a=r(7437),s=n.forwardRef((e,t)=>{let{children:r,...o}=e,s=n.Children.toArray(r),l=s.find(c);if(l){let e=l.props.children,r=s.map(t=>t!==l?t:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,a.jsx)(i,{...o,ref:t,children:n.isValidElement(e)?n.cloneElement(e,void 0,r):null})}return(0,a.jsx)(i,{...o,ref:t,children:r})});s.displayName="Slot";var i=n.forwardRef((e,t)=>{let{children:r,...a}=e;if(n.isValidElement(r)){let e,s;let i=(e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.props.ref:r.props.ref||r.ref;return n.cloneElement(r,{...function(e,t){let r={...t};for(let n in t){let o=e[n],a=t[n];/^on[A-Z]/.test(n)?o&&a?r[n]=(...e)=>{a(...e),o(...e)}:o&&(r[n]=o):"style"===n?r[n]={...o,...a}:"className"===n&&(r[n]=[o,a].filter(Boolean).join(" "))}return{...e,...r}}(a,r.props),ref:t?(0,o.F)(t,i):i})}return n.Children.count(r)>1?n.Children.only(null):null});i.displayName="SlotClone";var l=({children:e})=>(0,a.jsx)(a.Fragment,{children:e});function c(e){return n.isValidElement(e)&&e.type===l}},535:function(e,t,r){"use strict";r.d(t,{j:function(){return s}});var n=r(1994);let o=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,a=n.W,s=(e,t)=>r=>{var n;if((null==t?void 0:t.variants)==null)return a(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:s,defaultVariants:i}=t,l=Object.keys(s).map(e=>{let t=null==r?void 0:r[e],n=null==i?void 0:i[e];if(null===t)return null;let a=o(t)||o(n);return s[e][a]}),c=r&&Object.entries(r).reduce((e,t)=>{let[r,n]=t;return void 0===n||(e[r]=n),e},{});return a(e,l,null==t?void 0:null===(n=t.compoundVariants)||void 0===n?void 0:n.reduce((e,t)=>{let{class:r,className:n,...o}=t;return Object.entries(o).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...i,...c}[t]):({...i,...c})[t]===r})?[...e,r,n]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}}},function(e){e.O(0,[6137,7107,2971,2117,1744],function(){return e(e.s=102)}),_N_E=e.O()}]);